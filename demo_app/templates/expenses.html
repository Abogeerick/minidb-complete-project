{% extends "base.html" %}

{% block title %}Expenses{% endblock %}

{% block content %}
<div class="flex flex-col md:flex-row md:items-center justify-between mb-8">
    <div>
        <h1 class="text-3xl font-bold text-gray-900">Expenses</h1>
        <p class="text-gray-500 mt-1">Manage your expense records</p>
    </div>
    <a href="{{ url_for('add_expense') }}"
        class="mt-4 md:mt-0 inline-flex items-center px-5 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-medium transition shadow-lg shadow-indigo-200">
        <i class="fas fa-plus mr-2"></i>
        Add Expense
    </a>
</div>

{% if expenses %}
<!-- SQL Query Display -->
<div class="bg-gray-900 text-gray-100 p-5 rounded-xl mb-6 font-mono text-sm overflow-x-auto border border-gray-700">
    <div class="flex items-center mb-3">
        <div class="flex space-x-2">
            <div class="w-3 h-3 rounded-full bg-red-500"></div>
            <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
            <div class="w-3 h-3 rounded-full bg-green-500"></div>
        </div>
        <span class="ml-4 text-gray-400 text-xs uppercase tracking-wide">SQL Query</span>
    </div>
    <div class="text-green-400">
        <span class="text-gray-500">-- INNER JOIN to get category names</span><br>
        <span class="text-blue-400">SELECT</span> e.id, e.description, e.amount, e.expense_date,<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.name <span class="text-blue-400">AS</span> category, c.color,
        c.icon<br>
        <span class="text-blue-400">FROM</span> expenses e<br>
        <span class="text-blue-400">JOIN</span> categories c <span class="text-blue-400">ON</span> e.category_id =
        c.id<br>
        <span class="text-blue-400">ORDER BY</span> e.expense_date <span class="text-blue-400">DESC</span>;
    </div>
</div>

<!-- Expenses Table -->
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
    <table class="w-full">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Description
                </th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Category
                </th>
                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Date</th>
                <th class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">Amount
                </th>
                <th class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">Actions
                </th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
            {% for expense in expenses %}
            <tr class="hover:bg-gray-50 transition">
                <td class="px-6 py-4">
                    <span class="font-medium text-gray-900">{{ expense.description }}</span>
                </td>
                <td class="px-6 py-4">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                        style="background-color: {{ expense.color }}22; color: {{ expense.color }};">
                        <i class="fas fa-{{ expense.icon or 'folder' }} mr-2 text-xs"></i>
                        {{ expense.category }}
                    </span>
                </td>
                <td class="px-6 py-4 text-gray-500">{{ expense.expense_date }}</td>
                <td class="px-6 py-4 text-right font-semibold text-gray-900">
                    KES {{ "{:,.2f}".format(expense.amount) }}
                </td>
                <td class="px-6 py-4 text-right">
                    <div class="flex justify-end space-x-2">
                        <a href="{{ url_for('edit_expense', expense_id=expense.id) }}"
                            class="p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition">
                            <i class="fas fa-edit"></i>
                        </a>
                        <form action="{{ url_for('delete_expense', expense_id=expense.id) }}" method="POST"
                            class="inline" onsubmit="return confirm('Are you sure you want to delete this expense?')">
                            <button type="submit"
                                class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p class="text-gray-500 text-sm mt-4 text-center">
    Showing {{ expenses|length }} expense(s)
</p>
{% else %}
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-12 text-center">
    <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="fas fa-receipt text-3xl text-gray-400"></i>
    </div>
    <h3 class="text-xl font-semibold text-gray-900 mb-2">No Expenses Yet</h3>
    <p class="text-gray-500 mb-6">Start tracking your spending by adding your first expense.</p>
    <a href="{{ url_for('add_expense') }}"
        class="inline-flex items-center px-5 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-medium transition">
        <i class="fas fa-plus mr-2"></i>
        Add Your First Expense
    </a>
</div>
{% endif %}
{% endblock %}